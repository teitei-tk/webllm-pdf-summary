# CLAUDE.md

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**webllmâ€‘pdfâ€‘summary** ã¯å¥‘ç´„æ›¸ãªã©ã®æ—¥æœ¬èª PDF ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ï¼ˆNext.js APIï¼‰ã§ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ˆWebLLMï¼‰ã§è¦ç´„ã™ã‚‹ PoC ã§ã™ã€‚è¦ç´„å‡¦ç†ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«é–‰ã˜ã‚‹ã“ã¨ã§æ©Ÿå¯†ä¿æŒã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ãƒ¬ã‚¤ãƒ¤         | æŠ€è¡“ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª                             | å‚™è€ƒ                                                                  |
| -------------- | -------------------------------------------- | --------------------------------------------------------------------- |
| ãƒ•ãƒ­ãƒ³ãƒˆ       | Next.jsÂ 15 / ReactÂ 19 / Materialâ€‘UIÂ (v6)     | ç”»é¢ã¯ `/` ã®ã¿                                                       |
| LLM(ãƒ–ãƒ©ã‚¦ã‚¶)  | WebLLMÂ (wasmÂ +Â WebGPU)                       | M2Â ProÂ 36â€¯GBâ€¯RAM å‘ã‘ãƒ¢ãƒ‡ãƒ«ï¼š`phiâ€‘3â€‘mini`ã€`llamaâ€‘3â€‘instructâ€‘8Bâ€‘Q4_0` |
| ã‚µãƒ¼ãƒ API     | Next.js API Route `/api/parse-pdf`           | `pdf-parse` ã¾ãŸã¯ `pdfjs`ã€ç”»åƒ PDF ã¯ `tesseract.js` ã§ OCR å¯      |
| ä¸€æ™‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | OS ã® `tmp` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                     | å‡¦ç†å¾Œã«å‰Šé™¤                                                          |
| ãƒ†ã‚¹ãƒˆ         | **VitestÂ +Â Testing Library**                 | _TDD å¾¹åº•_                                                            |
| é™çš„è§£æ       | **ESLint (`eslint:recommended`) + Prettier** | â€•                                                                     |

---

## æ©Ÿèƒ½è¦ä»¶

### UI / UX

- `/` ç”»é¢ã®ã¿ï¼šPDF é¸æŠ â–¶ ã‚¹ãƒ”ãƒŠãƒ¼ â–¶ è¦ç´„çµæœã‚«ãƒ¼ãƒ‰ï¼‹ã‚³ãƒ”ãƒ¼
- å±¥æ­´ãƒ»è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»èªè¨¼ãªã—
- `npm run dev` ã§å³åˆ©ç”¨

### PDF æŠ½å‡ºï¼ˆã‚µãƒ¼ãƒï¼‰

- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆãƒ»è¡¨ï¼ˆæ”¹è¡Œï¼‹ã‚¿ãƒ–åŒºåˆ‡ã‚Šï¼‰å¯¾å¿œ
- ç”»åƒ PDF ãªã‚‰ `{ ocr: true }` ã‚’å«ã‚ã¦ JSON è¿”å´
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯ `{ "error": "message" }`

### è¦ç´„å‡¦ç†ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰

- 4Â 000 æ–‡å­—ï¼ãƒãƒ£ãƒ³ã‚¯ã§åˆ†å‰² â†’ éƒ¨åˆ†è¦ç´„ â†’ ãƒãƒ¼ã‚¸è¦ç´„
- è¦ç´„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

  ```text
  ä¸ãˆã‚‰ã‚ŒãŸæ–‡ç« ã‚’æ—¥æœ¬èªã§ 10 è¡Œä»¥å†…ã«è¦ç´„ã—ã€é‡è¦èªã« â˜… ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚
  ```

- å¤±æ•—æ™‚ã¯ãƒˆãƒ¼ã‚¹ãƒˆã€Œè¦ç´„ã«å¤±æ•—ã—ã¾ã—ãŸã€ï¼‹ `status` ä¿æŒ

---

## éæ©Ÿèƒ½ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

| é …ç›®             | è¦ä»¶                                                     |
| ---------------- | -------------------------------------------------------- |
| æ©Ÿå¯†ä¿æŒ         | æŠ½å‡ºãƒ†ã‚­ã‚¹ãƒˆã®ã¿ãƒ•ãƒ­ãƒ³ãƒˆè»¢é€ã€‚PDF æœ¬ä½“ãƒ»è¦ç´„ã¯ä¿å­˜ã—ãªã„ |
| æ€§èƒ½ç›®æ¨™         | 10â€¯MBï¼200â€¯ãƒšãƒ¼ã‚¸ PDF ã‚’ 30â€¯ç§’ä»¥å†…ã«è¦ç´„                 |
| ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ | ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãƒ»`aria-label` æœ€ä½é™                      |
| ãƒ­ã‚®ãƒ³ã‚°         | é–‹ç™ºæ™‚ã®ã¿ `console.debug`ã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã¯é™¤å»           |

---

## ğŸ§‘â€ğŸ’» CodingÂ Rules

1. **TDD ã‚’å®Ÿæ–½ã™ã‚‹** â€” ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã¨ãã¯å¿…ãšå¯¾å¿œã™ã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã€`npm test` ãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

   ```ts
   // ä¾‹ â€“ è¶³ã—ç®—é–¢æ•°ã¨ãƒ†ã‚¹ãƒˆ
   function add(a: number, b: number) {
     return a + b;
   }
   test('1+2=3', () => {
     expect(add(1, 2)).toBe(3);
   });
   ```

2. **å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å†’é ­ã«ä»•æ§˜ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã™ã‚‹**

   ```ts
   /**
    * 2 ç‚¹é–“ã®ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ã‚’è¨ˆç®—ã™ã‚‹
    */
   type Point = { x: number; y: number };
   export function distance(a: Point, b: Point): number {
     return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
   }
   ```

3. **Vitest ã§å®Ÿè£…ã¨åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ã**

   ```ts
   export function distance(a: Point, b: Point): number {
     /* ... */
   }

   if (import.meta.vitest) {
     const { test, expect } = import.meta.vitest;
     test('ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ã‚’è¨ˆç®—ã™ã‚‹', () => {
       const result = distance({ x: 0, y: 0 }, { x: 3, y: 4 });
       expect(result).toBe(5);
     });
   }
   ```

4. **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** â€” Conventional Commits (`feat:`, `fix:` â€¦)

5.	ã‚¿ã‚¹ã‚¯å®Ÿè¡Œå¾Œã¯å¿…ãš npm run test, npm run lint, npm run format:check ã‚’å®Ÿè¡Œã—ã€ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼ãªã—ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã“ã¨

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆæ¡ˆï¼‰

```text
webllm-pdf-summary
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                 # ãƒ«ãƒ¼ãƒˆ UI (PDF ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ & è¦ç´„è¡¨ç¤º)
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ parse-pdf/route.ts   # Edge/API Route â€“ PDFâ†’ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ pdf/
â”‚   â”‚   â””â”€â”€ extract.ts           # ã‚µãƒ¼ãƒãƒ¼å´æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ llm/
â”‚       â”œâ”€â”€ chunk.ts             # åˆ†å‰²ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â””â”€â”€ summarize.ts         # WebLLM å‘¼ã³å‡ºã—
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SummaryCard.tsx          # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ README.md
```

---

## ä»Šå¾Œã®æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

- ç”»åƒ PDF ç”¨ OCR ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- CloudflareÂ R2 + ç½²åä»˜ã URL ã§ä¸€æ™‚ä¿å­˜
- ãƒ¢ãƒ‡ãƒ«é¸æŠ UIï¼ˆphiâ€‘3ï¼llamaâ€‘3 etc.ï¼‰
- SSE ã§è¦ç´„é€²æ—ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
